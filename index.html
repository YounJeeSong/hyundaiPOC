<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>프로젝트 조회 - 현대자동차 R&D Parameter DB</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap');
        
        :root {
            --hyundai-blue: #002c5f;
            --white: #ffffff;
            --hyundai-sand: #e4dcd3;
            --hyundai-light-sand: #f6f3f2;
            --grey-dark: #676767;
            --grey-light: #cccccc;
            --progressive-blue: #00aad2;
            --grey-66: #666666;
            --grey-33: #333333;
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Noto Sans KR', sans-serif; background: #f6f3f2; }
        .app-container { display: flex; height: 100vh; overflow: hidden; }
        
        /* Navigation Reset */
        .global-nav, .global-nav * {
            font-weight: 400 !important;
            letter-spacing: 0 !important;
            line-height: 1.5 !important;
            -webkit-font-smoothing: subpixel-antialiased !important;
        }
        
        .global-nav { width: 240px; background: #002c5f; color: #fff; display: flex; flex-direction: column; flex-shrink: 0; }
        .logo-area { padding: 24px; border-bottom: 1px solid rgba(255, 255, 255, 0.1); }
        .logo-title { font-size: 20px; font-weight: 500; }
        .logo-subtitle { font-size: 14px; opacity: 0.7; margin-top: 4px; }
        .nav-menu { flex: 1; padding: 16px; }
        .nav-item { display: flex; align-items: center; gap: 12px; padding: 12px 16px; color: #fff; font-size: 14px; border-radius: 4px; cursor: pointer; transition: 0.3s ease; margin-bottom: 4px; }
        .nav-item:hover { background: rgba(255, 255, 255, 0.1); }
        .nav-item.active { background: #00aad2; }
        
        .main-content { flex: 1; display: flex; flex-direction: column; }
        .top-bar { height: 70px; background: #fff; border-bottom: 1px solid #e4dcd3; display: flex; align-items: center; gap: 16px; padding: 0 32px; }
        .page-title { font-size: 24px; font-weight: 500; color: #002c5f; }
        
        /* View Tabs */
        .view-tabs {
            display: flex;
            gap: 4px;
            background: var(--hyundai-light-sand);
            padding: 4px;
            border-radius: 8px;
            margin-left: 24px;
        }
        .view-tab {
            padding: 8px 20px;
            border: none;
            background: transparent;
            font-size: 14px;
            font-weight: 500;
            color: var(--grey-66);
            cursor: pointer;
            border-radius: 6px;
            transition: 0.15s ease;
        }
        .view-tab:hover { background: rgba(0, 44, 95, 0.05); }
        .view-tab.active { background: var(--hyundai-blue); color: var(--white); }
        
        .top-bar-right { margin-left: auto; }
        .btn { padding: 12px 24px; border: 1px solid #e4dcd3; border-radius: 4px; font-size: 14px; cursor: pointer; }
        .btn-primary { background: #002c5f; color: #fff; border: none; }
        
        .content-area { flex: 1; overflow-y: auto; padding: 32px; }
        
        /* 뷰 컨테이너 */
        .view-container { display: none; }
        .view-container.active { display: block; }
        
        /* ========== 버전 뷰 (프로젝트 카드 그리드) ========== */
        .project-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 24px; }
        
        .project-card { background: #fff; border: 1px solid #e4dcd3; border-radius: 8px; overflow: hidden; transition: 0.2s; position: relative; }
        .project-card:hover { box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1); transform: translateY(-2px); }
        .project-card-preview { height: 180px; background: #f6f3f2; display: flex; align-items: center; justify-content: center; position: relative; overflow: hidden; }
        .project-card-preview img { width: 100%; height: 100%; object-fit: contain; }
        .project-card-category { position: absolute; top: 12px; left: 12px; padding: 4px 12px; background: #002c5f; color: #fff; font-size: 12px; border-radius: 12px; }
        .project-card-body { padding: 16px; }
        .project-card-title { font-size: 16px; font-weight: 500; color: #002c5f; margin-bottom: 8px; }
        .project-card-info { font-size: 14px; color: #676767; margin-bottom: 12px; }
        .project-card-description { font-size: 14px; color: #676767; margin-bottom: 12px; min-height: 2.8em; }
        .project-card-footer { display: flex; justify-content: space-between; padding-top: 12px; border-top: 1px solid #e4dcd3; }
        .project-card-date { font-size: 12px; color: #676767; }
        
        /* 호버 오버레이 */
        .project-card-overlay {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0, 44, 95, 0.85);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 12px;
            opacity: 0;
            transition: opacity 0.2s;
            z-index: 10;
        }
        .project-card:hover .project-card-overlay { opacity: 1; }
        .overlay-btn {
            padding: 10px 32px;
            border-radius: 4px;
            font-size: 14px;
            cursor: pointer;
            border: none;
            min-width: 120px;
            transition: 0.2s;
        }
        .overlay-btn-open { background: #00aad2; color: #fff; }
        .overlay-btn-open:hover { background: #008fb3; }
        .overlay-btn-delete { background: transparent; color: #fff; border: 1px solid rgba(255,255,255,0.5); }
        .overlay-btn-delete:hover { background: rgba(255,255,255,0.1); border-color: #fff; }
        
        /* ========== 세트 뷰 ========== */
        .set-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px; }
        
        .set-card {
            background: var(--white);
            border: 1px solid var(--hyundai-sand);
            border-radius: 8px;
            overflow: hidden;
            transition: 0.2s;
            cursor: pointer;
        }
        .set-card:hover { box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1); transform: translateY(-2px); }
        
        .set-card-header {
            padding: 16px;
            background: var(--hyundai-light-sand);
            border-bottom: 1px solid var(--hyundai-sand);
        }
        .set-card-title { font-size: 15px; font-weight: 600; color: var(--grey-33); margin-bottom: 4px; }
        .set-card-subtitle { font-size: 13px; color: var(--grey-66); }
        
        .set-card-body { padding: 16px; }
        .set-card-param {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            font-size: 13px;
            border-bottom: 1px solid var(--hyundai-light-sand);
        }
        .set-card-param:last-child { border-bottom: none; }
        .set-card-param-name { color: var(--grey-66); }
        .set-card-param-value { font-weight: 600; font-family: 'Courier New', monospace; }
        
        .set-card-footer {
            padding: 12px 16px;
            background: var(--hyundai-light-sand);
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 12px;
            color: var(--grey-66);
        }
        .set-card-badge {
            padding: 4px 10px;
            background: var(--hyundai-blue);
            color: var(--white);
            border-radius: 12px;
            font-size: 11px;
        }
        
        /* ========== 파라미터 뷰 ========== */
        .param-view-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        .param-stats {
            display: flex;
            gap: 24px;
        }
        .param-stat {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            color: var(--grey-66);
        }
        .param-stat-value {
            font-weight: 600;
            color: var(--hyundai-blue);
            font-size: 18px;
        }
        
        .param-table-container {
            background: var(--white);
            border: 1px solid var(--hyundai-sand);
            border-radius: 8px;
            overflow: hidden;
        }
        .param-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 13px;
        }
        .param-table th {
            background: var(--hyundai-blue);
            color: var(--white);
            padding: 14px 16px;
            text-align: left;
            font-weight: 500;
        }
        .param-table td {
            padding: 12px 16px;
            border-bottom: 1px solid var(--hyundai-light-sand);
        }
        .param-table tr:hover { background: var(--hyundai-light-sand); }
        .param-table tr:last-child td { border-bottom: none; }
        
        .param-name-cell { font-weight: 500; color: var(--grey-33); }
        .param-value-cell { font-family: 'Courier New', monospace; font-weight: 600; color: var(--hyundai-blue); }
        .param-unit { color: var(--grey-66); }
        .param-set-badge {
            display: inline-block;
            padding: 4px 10px;
            background: var(--hyundai-light-sand);
            border-radius: 4px;
            font-size: 12px;
            color: var(--grey-66);
        }
        .param-project-badge {
            display: inline-block;
            padding: 4px 10px;
            background: var(--progressive-blue);
            color: var(--white);
            border-radius: 4px;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <nav class="global-nav">
            <div class="logo-area">
                <div class="logo-title">R&D Parameter DB</div>
                <div class="logo-subtitle">현대자동차</div>
            </div>
            <div class="nav-menu">
                <div class="nav-item active" onclick="location.href='index.html'">
                    <svg width="20" height="20" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"/>
                        <path fill-rule="evenodd" d="M4 5a2 2 0 012-2 3 3 0 003 3h2a3 3 0 003-3 2 2 0 012 2v11a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm9.707 5.707a1 1 0 00-1.414-1.414L9 12.586l-1.293-1.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                    </svg>
                    데이터조회
                </div>
                <div class="nav-item" onclick="location.href='create-step1.html'">
                    <svg width="20" height="20" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd"/>
                    </svg>
                    데이터 생성
                </div>
                <div class="nav-item" onclick="location.href='kpi-analysis.html'">
                    <svg width="20" height="20" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M3 3a1 1 0 000 2v8a2 2 0 002 2h2.586l-1.293 1.293a1 1 0 101.414 1.414L10 15.414l2.293 2.293a1 1 0 001.414-1.414L12.414 15H15a2 2 0 002-2V5a1 1 0 100-2H3zm11.707 4.707a1 1 0 00-1.414-1.414L10 9.586 8.707 8.293a1 1 0 00-1.414 0l-2 2a1 1 0 101.414 1.414L8 10.414l1.293 1.293a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                    </svg>
                    해석
                </div>
                <div class="nav-item" onclick="location.href='simulation-setup.html'">
                    <svg width="20" height="20" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M11.3 1.046A1 1 0 0112 2v5h4a1 1 0 01.82 1.573l-7 10A1 1 0 018 18v-5H4a1 1 0 01-.82-1.573l7-10a1 1 0 011.12-.38z" clip-rule="evenodd"/>
                    </svg>
                    시뮬레이션
                </div>
            </div>
        </nav>
        <div class="main-content">
            <div class="top-bar">
                <h1 class="page-title">데이터조회</h1>
                <div class="view-tabs">
                    <button class="view-tab active" onclick="switchView('version')">버전 뷰</button>
                    <button class="view-tab" onclick="switchView('set')">세트 뷰</button>
                    <button class="view-tab" onclick="switchView('param')">파라미터 뷰</button>
                </div>
                <div class="top-bar-right">
                    <button class="btn btn-primary" onclick="window.location.href='create-step1.html'">+ 새 프로젝트</button>
                </div>
            </div>
            <div class="content-area">
                <!-- 버전 뷰 (프로젝트 카드) -->
                <div class="view-container active" id="versionView">
                    <div class="project-grid" id="projectGrid"></div>
                </div>
                
                <!-- 세트 뷰 -->
                <div class="view-container" id="setView">
                    <div class="set-grid" id="setGrid"></div>
                </div>
                
                <!-- 파라미터 뷰 -->
                <div class="view-container" id="paramView">
                    <div class="param-view-header">
                        <div class="param-stats">
                            <div class="param-stat">
                                <span>전체 파라미터</span>
                                <span class="param-stat-value" id="totalParamCount">0</span>
                            </div>
                            <div class="param-stat">
                                <span>전체 세트</span>
                                <span class="param-stat-value" id="totalSetCount">0</span>
                            </div>
                        </div>
                    </div>
                    <div class="param-table-container">
                        <table class="param-table">
                            <thead>
                                <tr>
                                    <th>파라미터명</th>
                                    <th>값</th>
                                    <th>단위</th>
                                    <th>세트</th>
                                    <th>프로젝트</th>
                                </tr>
                            </thead>
                            <tbody id="paramTableBody"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>
        const ENGINE_IMAGE = 'Suspension.png';

        // 더미 프로젝트 데이터
        const dummyProjects = [
            {
                id: 1001,
                name: '2025 GV90 전륜 서스펜션 시스템',
                category: '서스펜션',
                description: '대형 SUV 승차감 최적화를 위한 전륜 서스펜션 파라미터',
                cardCount: 8,
                createdAt: new Date(Date.now() - 1 * 24 * 60 * 60 * 1000).toISOString(),
                sets: [
                    { name: 'FR_SPRING', subtitle: '전륜 스프링', params: [
                        { name: 'Spring Rate', value: '45.2', unit: 'N/mm' },
                        { name: 'Free Length', value: '380', unit: 'mm' },
                        { name: 'Wire Dia', value: '14.5', unit: 'mm' }
                    ]},
                    { name: 'FR_DAMPER', subtitle: '전륜 댐퍼', params: [
                        { name: 'Comp Force', value: '1250', unit: 'N' },
                        { name: 'Reb Force', value: '2100', unit: 'N' }
                    ]}
                ]
            },
            {
                id: 1002,
                name: 'E-GMP 배터리 냉각 모듈 v2.3',
                category: '배터리',
                description: '고속충전 대응 열관리 시스템 설계 파라미터',
                cardCount: 12,
                createdAt: new Date(Date.now() - 3 * 24 * 60 * 60 * 1000).toISOString(),
                sets: [
                    { name: 'COOLING_PLATE', subtitle: '냉각 플레이트', params: [
                        { name: 'Flow Rate', value: '12.5', unit: 'L/min' },
                        { name: 'Thermal Cond', value: '205', unit: 'W/mK' }
                    ]}
                ]
            },
            {
                id: 1003,
                name: 'IONIQ 7 전동 파워스티어링',
                category: '조향',
                description: 'R-MDPS 조향감 튜닝 및 응답성 파라미터',
                cardCount: 6,
                createdAt: new Date(Date.now() - 5 * 24 * 60 * 60 * 1000).toISOString(),
                sets: [
                    { name: 'STEERING_RATIO', subtitle: '조향비', params: [
                        { name: 'Ratio', value: '14.5', unit: ':1' },
                        { name: 'Assist Torque', value: '6.2', unit: 'Nm' }
                    ]}
                ]
            },
            {
                id: 1004,
                name: 'N브랜드 샤시 강성 해석',
                category: '샤시',
                description: '고성능 차량 바디 강성 및 NVH 특성 분석',
                cardCount: 15,
                createdAt: new Date(Date.now() - 7 * 24 * 60 * 60 * 1000).toISOString(),
                sets: [
                    { name: 'BODY_STIFFNESS', subtitle: '바디 강성', params: [
                        { name: 'Torsional', value: '42500', unit: 'Nm/deg' },
                        { name: 'Bending', value: '18200', unit: 'N/mm' }
                    ]}
                ]
            },
            {
                id: 1005,
                name: '통합 브레이크 시스템 IDB2',
                category: '제동',
                description: '회생제동 연계 유압제동 파라미터 설정',
                cardCount: 9,
                createdAt: new Date(Date.now() - 10 * 24 * 60 * 60 * 1000).toISOString(),
                sets: [
                    { name: 'REGEN_BRAKE', subtitle: '회생제동', params: [
                        { name: 'Max Regen', value: '80', unit: 'kW' },
                        { name: 'Blend Point', value: '0.25', unit: 'g' }
                    ]}
                ]
            },
            {
                id: 1006,
                name: '후륜 멀티링크 지오메트리',
                category: '서스펜션',
                description: '5-Link 후륜 서스펜션 킥백 저감 설계',
                cardCount: 7,
                createdAt: new Date(Date.now() - 14 * 24 * 60 * 60 * 1000).toISOString(),
                sets: [
                    { name: 'RR_GEOMETRY', subtitle: '후륜 지오메트리', params: [
                        { name: 'Camber', value: '-1.2', unit: 'deg' },
                        { name: 'Toe', value: '0.15', unit: 'deg' },
                        { name: 'Caster', value: '4.5', unit: 'deg' }
                    ]}
                ]
            }
        ];

        let allProjects = [];

        document.addEventListener('DOMContentLoaded', function() {
            initSampleData();
        });

        function initSampleData() {
            const DATA_VERSION = 'v4';
            let projectList = JSON.parse(localStorage.getItem('projectList') || '[]');
            
            if (localStorage.getItem('dataVersion') !== DATA_VERSION || projectList.length === 0) {
                localStorage.clear();
                localStorage.setItem('dataVersion', DATA_VERSION);
                
                projectList = dummyProjects.map(function(p) {
                    return {
                        id: p.id,
                        name: p.name,
                        category: p.category,
                        createdAt: p.createdAt,
                        cardCount: p.cardCount
                    };
                });
                
                dummyProjects.forEach(function(p) {
                    const projectData = {
                        id: p.id,
                        meta: {
                            projectName: p.name,
                            category: p.category,
                            description: p.description,
                            createdAt: p.createdAt,
                            step: 2
                        },
                        cards: [],
                        sets: p.sets,
                        layout: { modelImageSrc: ENGINE_IMAGE }
                    };
                    localStorage.setItem('project_' + p.id, JSON.stringify(projectData));
                });
                
                localStorage.setItem('projectList', JSON.stringify(projectList));
            }
            
            loadProjects();
        }

        function loadProjects() {
            const projectList = JSON.parse(localStorage.getItem('projectList') || '[]');
            
            allProjects = projectList.map(function(proj) {
                const projectData = JSON.parse(localStorage.getItem('project_' + proj.id) || '{}');
                return {
                    ...proj,
                    description: projectData.meta ? projectData.meta.description : '',
                    modelImageSrc: projectData.layout ? projectData.layout.modelImageSrc : null,
                    sets: projectData.sets || []
                };
            });
            
            renderVersionView();
            renderSetView();
            renderParamView();
        }

        // ========== 뷰 전환 ==========
        function switchView(viewType) {
            document.querySelectorAll('.view-tab').forEach(function(tab) {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.view-container').forEach(function(view) {
                view.classList.remove('active');
            });
            
            event.target.classList.add('active');
            
            if (viewType === 'version') {
                document.getElementById('versionView').classList.add('active');
            } else if (viewType === 'set') {
                document.getElementById('setView').classList.add('active');
            } else if (viewType === 'param') {
                document.getElementById('paramView').classList.add('active');
            }
        }

        // ========== 버전 뷰 렌더링 ==========
        function renderVersionView() {
            const grid = document.getElementById('projectGrid');
            
            grid.innerHTML = allProjects.map(function(project) {
                return '<div class="project-card">' +
                    '<div class="project-card-preview">' +
                    (project.modelImageSrc ? '<img src="' + project.modelImageSrc + '" alt="' + project.name + '">' : '') +
                    '<div class="project-card-category">' + project.category + '</div>' +
                    '<div class="project-card-overlay">' +
                        '<button class="overlay-btn overlay-btn-open" onclick="openProject(' + project.id + ')">열기</button>' +
                        '<button class="overlay-btn overlay-btn-delete" onclick="deleteProject(event, ' + project.id + ')">삭제</button>' +
                    '</div>' +
                    '</div>' +
                    '<div class="project-card-body">' +
                    '<div class="project-card-title">' + project.name + '</div>' +
                    '<div class="project-card-info">' + project.cardCount + '개 카드</div>' +
                    '<div class="project-card-description">' + (project.description || '설명 없음') + '</div>' +
                    '<div class="project-card-footer">' +
                    '<div class="project-card-date">' + formatDate(project.createdAt) + '</div>' +
                    '</div>' +
                    '</div>' +
                    '</div>';
            }).join('');
        }

        // ========== 세트 뷰 렌더링 ==========
        function renderSetView() {
            const grid = document.getElementById('setGrid');
            let html = '';
            
            allProjects.forEach(function(project) {
                if (project.sets && project.sets.length > 0) {
                    project.sets.forEach(function(set) {
                        html += '<div class="set-card" onclick="openProject(' + project.id + ')">' +
                            '<div class="set-card-header">' +
                                '<div class="set-card-title">' + set.name + '</div>' +
                                '<div class="set-card-subtitle">' + set.subtitle + '</div>' +
                            '</div>' +
                            '<div class="set-card-body">';
                        
                        set.params.forEach(function(param) {
                            html += '<div class="set-card-param">' +
                                '<span class="set-card-param-name">' + param.name + '</span>' +
                                '<span class="set-card-param-value">' + param.value + ' ' + param.unit + '</span>' +
                            '</div>';
                        });
                        
                        html += '</div>' +
                            '<div class="set-card-footer">' +
                                '<span class="set-card-badge">' + project.category + '</span>' +
                                '<span>' + project.name + '</span>' +
                            '</div>' +
                        '</div>';
                    });
                }
            });
            
            grid.innerHTML = html;
        }

        // ========== 파라미터 뷰 렌더링 ==========
        function renderParamView() {
            const tbody = document.getElementById('paramTableBody');
            let allParams = [];
            let totalSets = 0;
            
            allProjects.forEach(function(project) {
                if (project.sets && project.sets.length > 0) {
                    totalSets += project.sets.length;
                    project.sets.forEach(function(set) {
                        set.params.forEach(function(param) {
                            allParams.push({
                                name: param.name,
                                value: param.value,
                                unit: param.unit,
                                setName: set.name,
                                projectName: project.name,
                                projectId: project.id
                            });
                        });
                    });
                }
            });
            
            tbody.innerHTML = allParams.map(function(p) {
                return '<tr onclick="openProject(' + p.projectId + ')" style="cursor:pointer;">' +
                    '<td class="param-name-cell">' + p.name + '</td>' +
                    '<td class="param-value-cell">' + p.value + '</td>' +
                    '<td class="param-unit">' + p.unit + '</td>' +
                    '<td><span class="param-set-badge">' + p.setName + '</span></td>' +
                    '<td><span class="param-project-badge">' + p.projectName + '</span></td>' +
                '</tr>';
            }).join('');
            
            document.getElementById('totalParamCount').textContent = allParams.length;
            document.getElementById('totalSetCount').textContent = totalSets;
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            const now = new Date();
            const days = Math.floor((now - date) / (1000 * 60 * 60 * 24));
            if (days === 0) return '오늘';
            if (days === 1) return '어제';
            if (days < 7) return days + '일 전';
            return date.toLocaleDateString('ko-KR');
        }

        function openProject(projectId) {
            window.location.href = 'view-detail.html?id=' + projectId;
        }

        function deleteProject(event, projectId) {
            event.preventDefault();
            event.stopPropagation();
            
            if (confirm('이 프로젝트를 삭제하시겠습니까?')) {
                localStorage.removeItem('project_' + projectId);
                
                let projectList = JSON.parse(localStorage.getItem('projectList') || '[]');
                projectList = projectList.filter(function(p) { return p.id !== projectId; });
                localStorage.setItem('projectList', JSON.stringify(projectList));
                
                loadProjects();
            }
        }
    </script>
</body>
</html>
